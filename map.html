<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Hugo 0.84.0">
    <title>Map Template Â· Bootstrap v5.0</title>

    <link rel="canonical" href="https://getbootstrap.com/docs/5.0/examples/dashboard/">

    <link rel="stylesheet" href="styles.css">
    <script src="class_definitions.js"></script>
    <script src="external_javascript.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>

    

    <!-- Bootstrap core CSS -->
 <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <style>
      .bd-placeholder-img {
        font-size: 1.125rem;
        text-anchor: middle;
        -webkit-user-select: none;
        -moz-user-select: none;
        user-select: none;
      }

      @media (min-width: 768px) {
        .bd-placeholder-img-lg {
          font-size: 3.5rem;
        }
      }
    </style>

    
    <!-- Custom styles for this template -->
    <link href="dashboard.css" rel="stylesheet">
  </head>
  <body>
    
<header class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0 shadow">
  <a class="navbar-brand col-md-3 col-lg-2 me-0 px-3" href="#">Company name</a>
  <button class="navbar-toggler position-absolute d-md-none collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <input class="form-control form-control-dark w-100" type="text" placeholder="Search" aria-label="Search">
  <div class="navbar-nav">
    <div class="nav-item text-nowrap">
      <a class="nav-link px-3" href="#">Sign out</a>
    </div>
  </div>
</header>

<div class="container-fluid">
  <div class="row">
    <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
      <div id = "menu_wrapper" class = "menu_wrapper">
        <div class="form-check form-switch"> 
        <input class="form-check-input activationCheckbox" type="checkbox" id = "nodeCheckbox" onclick="handleCheckbox('node', 'nodeCheckbox')" checked="true"> 
        <label class="form-check-label"  for="nodeCheckbox"> Toggle All Nodes</label>
      </div>              
        <input class="activationCheckbox" type="checkbox" id = "inactiveCheckbox" onclick="handleCheckbox('inactive', 'inactiveCheckbox')" checked="true"> 
        <label for="inactiveCheckbox"> Toggle Inactive Nodes</label><br> 
        
        
        <div class="form-check form-switch">
        <input class="activationCheckbox form-check-input" type="checkbox" id = "attackCheckbox" onclick="handleCheckbox('attack', 'attackCheckbox')" checked="true"> 
         <label for="attackCheckbox form-check-label"> Toggle Attacks</label>
         </div>            
        <input class="activationCheckbox" type="checkbox" id = "leaderCheckbox" onclick="handleCheckbox('leader', 'leaderCheckbox')" checked="true"> 
        <label for="leaderCheckbox"> Toggle Leaders</label><br>              

        <input type="range" min = "0" max = "3" step = "1" value = "1" id = "zoomRange" oninput="handleSliderInput()"> 
         <br><label for="zoomRange"> Timeline Resolution</label>              

          <span id="resolutionText"> 1 Year </span> <br>
        <button onclick="handleResetInput()">Reset Pan</button><br>
        <br>      
        <input id="domainInput"> 
        <button onclick="handleDomainInput()">Change Domain</button>
        <button id="domainReset">Reset Domain</button>
    </div>


      <div class="position-sticky pt-3">
        <ul class="nav flex-column">
          <li class="nav-item">
         <a class="nav-link active" aria-current="page" href="#">
              <span data-feather="home"></span>
              Example of link
            </a>
          </li>
           
          <li class="nav-item">
            <a class="nav-link" href="#">
              <span data-feather="bar-chart-2"></span>
              Reports
            </a>
          </li>
        
        </ul>

         
      </div>
    </nav>

    <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
      <div> <button onclick="hideSidebar()">Hide Sidebar</button> </div>
      <script>
function hideSidebar() {
   var x =  ("sidebarMenu");
  console.log(x)
  if (x.style.display === "none") {
    x.style.display = "block";
  } else {
    x.style.display = "none";
  }
}
</script>
      <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2">Name of MMP Group or Map</h1>
        <div class="btn-toolbar mb-2 mb-md-0">
          <div class="btn-group me-2">
            <button type="button" class="btn btn-sm btn-outline-secondary">Share</button>
            <button type="button" class="btn btn-sm btn-outline-secondary">Export</button>
          </div>
          <button type="button" class="btn btn-sm btn-outline-secondary dropdown-toggle">
            <span data-feather="calendar"></span>
            This week
          </button>
        </div>
      </div>

 <div class=" holder shadow border-1">
      <div id = "description_div">
        <span id="date_span"></span>
        <br><br>
        <span id="description_span"></span>
    </div>
    <div id = "main_timeline" class = "main_timeline"></div>

  </div>

            <script type="text/javascript">
            const url_obj = new URL(document.URL); // makes a url object
            const params_obj = new URLSearchParams(url_obj.search);

            var ratio_param = params_obj.get('ratio'); // split into individual variables
            if (ratio_param){
                ratio_param = parseFloat(ratio_param);
                let slider = document.getElementById("zoomRange");
                let span = document.getElementById("resolutionText");
                let resolution = resolutionDict.find(element => element.height === ratio_param);
                slider.value = resolution.value;
                span.innerText = resolution.text;
            }
            else{ratio_param = 1};
            var domain_param = params_obj.get('domain'); // ''
            // if (domain_param){domain_param = domain_param.split(',')};
            var click_param = params_obj.get('click'); // ''

            // moving the div over to replicate real webpage, still not great because its absolute positioning :(
            var width_ratio = .7;

            var working_div = document.getElementById("main_timeline");
           // working_div.style.position = "absolute";
            working_div.style.left = ((1-width_ratio)*window.screen.width)+'px';
            working_div.style.top = 50+'px';

        
            // setting up a workspace

            var w = width_ratio * window.screen.width;
            var svg_h = 500;
            const default_height = 1500;
            var h = ratio_param * default_height; // this no longer sets the height of the svg, but rather the height of the elements within it!
            var padding = 50;
            var radius = 15;
            var svg = d3.select("#main_timeline").append("svg").attr("id", "svg")
            .attr("height", svg_h).attr("width", w)
            .attr("style", "outline: thin solid red");

            var main_g = svg.append('g').attr("id", "main_g");

            function handleZoom(e) {
                d3.select('#main_g').attr("transform", e.transform);
            }

            let zoom = d3.zoom()
            .on('zoom', handleZoom)
            .scaleExtent([1,1]) // disables zoom
            .translateExtent([[0,0], [w,h]]); // keeps panning within bounds

            d3.select('svg').call(zoom);


            var todays_date = new Date();
            var todays_year = todays_date.getFullYear();
            var parseTime = d3.timeParse("%Y-%m-%d");

            // creating the (currently) empty dataset
            var processed_data = {
                nodes: [],
                events: [],
                relationships: []
            };

            d3.json("olddata.json")
            .then(function(data){
                // big data read 
                // reading groups and events
                for (i=0; i< data.groups.length; i++){
                    let group = data.groups[i].Group;
                    processed_data.nodes.push(new group_class(
                        group.id, group.name, group.shortname,
                        parseTime(group.startdate), parseTime(group.enddate),
                        group.active,
                        0, 0,
                        group.description
                    ))

                    let attack_list = data.groups[i].Attack;
                    if (attack_list.length != 0) {for (j=0; j < attack_list.length; j++){
                        let attack = attack_list[j];
                        if (attack.date === undefined){attack.date = attack.startdate;} // bad data, fixing it
                        if (attack.date.endsWith("00-00")){attack.date = attack.date.substr(0,5) + "01-01"};

                        processed_data.events.push(new event_class(
                            attack.id, "attack", attack.description, parseTime(attack.date), attack.group_id,
                            0, 0
                        ))
                    }}

                    let leader_list = data.groups[i].Leader;
                    if (leader_list.length != 0) {for (j=0; j < leader_list.length; j++){
                        let leader = leader_list[j];
                        if (leader.startdate === undefined){leader.startdate = leader.date;} // bad data, fixing it
                        if (leader.startdate.endsWith("00-00")){leader.startdate = leader.startdate.substr(0,5) + "01-01"};
                        processed_data.events.push(new event_class(
                            leader.id, "leader", leader.description, parseTime(leader.startdate), leader.group_id,
                            0, 0
                        ))
                    }}
                }

                // reading relationships
                for (i=0; i<data.links.length; i++){
                    let relationship = data.links[i].Link;
                    processed_data.relationships.push(new relationship_class(
                        relationship.type, parseTime(relationship.date),
                        relationship.group1, relationship.group2, 
                        0, 0, 0
                    ))
                }
                // end big data read

                // finding the minimum year
                var date_min = d3.min(processed_data.nodes, function(d){
                    return d.startdate;
                })

                let year_min = date_min.getFullYear();

                // setting up the domain input textbox
                let domainInput = document.getElementById('domainInput');
                let defDomainValue = year_min + "," + todays_year;
                var initDomainValue;
                if (domain_param){initDomainValue = domain_param}
                else {initDomainValue = defDomainValue};

                domainInput.value = initDomainValue;
                domainInput.placeholder = initDomainValue;

                initDomainArray = initDomainValue.split(',');
                for (i=0; i<2; i++){initDomainArray[i] = yearToDate(initDomainArray[i])};

                // initiate time scale
                tScale = d3.scaleTime().domain(initDomainArray).range([padding, h-padding]);

                // giving reset domain button its function

                function handleDomainReset(){
                    handleDomainChange(date_min, todays_date);
                    domainInput.value = defDomainValue;
                    domainInput.placeholder = defDomainValue;
                }

                document.getElementById('domainReset').onclick = handleDomainReset;

                updateChart();

                // if there was a click in url, we need to have it clicked
                if (click_param){
                    click_array = click_param.split(',');
                    handleClick(click_array[0], click_array[1]);
                };

            })
        </script>
      
    </main>
  </div>
</div>


  <script src="https://cdn.jsdelivr.net/npm/feather-icons@4.28.0/dist/feather.min.js" integrity="sha384-uO3SXW5IuS1ZpFPKugNNWqTZRRglnUJK6UAZ/gxOX80nxEkN9NcGZTftn6RzhGWE" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js" integrity="sha384-zNy6FEbO50N+Cg5wap8IKA4M/ZnLJgzc6w2NqACZaK0u0FXfOWRRJOnQtpZun8ha" crossorigin="anonymous"></script><script src="dashboard.js"></script>
  </body>
</html>
